var markitup_settings={};if(!Array.indexOf){Array.prototype.indexOf=function(b,c){for(var a=(c||0);a<this.length;a++){if(this[a]==b){return a}}return -1}}(function(c){var b=function(d){try{window.console.log(d)}catch(f){}};c.fn.extend({getFaField:function(d){var f=c(this).attr("id").split("-",2).join("-");var e=document.getElementById(f+"-"+d);return c(e)}});var a=function(e,d){return function(g,f){c(function(){var j=document.getElementById(g);if(j){j=c(j)}else{j=c('input[name="'+g+'"]')}var h=document.getElementById(g+"_"+e);if(h){h=c(h)}var i=function(){try{c.fa_plugins[e](j,h,f);return true}catch(l){b("Error while loading "+e+" for "+g+" - "+f+": "+l);return false}};setTimeout(function(){if(!i()){b("Retrying in 0.7s...");setTimeout(i,700)}},300)})}};c.extend({fa_plugins:{},fa_resources:new Array(),fa:{extend:function(d){for(k in d){c.extend(c.fa_plugins,d);c.fa[k]=a(k,d[k])}},add_resource:function(d){if(!d||c.fa_resources.indexOf(d)>-1){return}c.fa_resources.push(d);var e=document.getElementsByTagName("head")[0]||document.documentElement;if(/\.js$/.test(d)){document.write('\u003Cscript src="'+d+'">\u003C/script>')}else{if(/\.css$/.test(d)){var f=document.createElement("link");f.type="text/css";f.rel="stylesheet";f.href=d;e.insertBefore(f,e.firstChild)}else{b("Invalid resource url: "+d)}}}},getFaField:function(d){field=c('input[id$="'+d+'"]');if(field.length==1){return field}}});c.fa.extend({datepicker:function(g,f,d){var e={};var h=g.val();if(d.lang){g.datepicker(c.datepicker.regional[d.lang])}else{g.datepicker()}g.datepicker("option",{dateFormat:d.dateFormat});g.val(h)},autocomplete:function(f,e,d){d.select=function(h,i){f.val(i.item.value)};var g=c('<input autocomplete="off" value="" />');g.val(f.val());g.autocomplete(d);e.append(g)},selectable:function(h,f,d){var g=c('<ul class="fa_selectable"></ul>');f.append(g);c("option",h).each(function(){var j=c(this);var i=g.append('<li class="ui-widget-content" alt="'+j.attr("value")+'">'+j.text()+"</li>")});var e=function(){var i=c(".ui-selected",g);i.removeClass("ui-selected");if(!d.multiple){c('li[alt="'+h.val()+'"]',g).addClass("ui-selected")}else{c(h.val()).each(function(){c('li[alt="'+this+'"]',g).addClass("ui-selected")})}};g.selectable({stop:function(){var i=c(".ui-selected",this);if(!d.multiple&&i.length>1){e()}else{var j=new Array();i.each(function(){j.push(c(this).attr("alt"))});if(d.multiple){h.val(j)}else{h.val(j)}}}});e()},buttonset:function(f,e,d){e.remove();div=f.parent("div");c("br",div).remove();div.buttonset();div.show()},sortable:function(g,f,e){var d=e.sep;var h=f;h.sortable({stop:function(){var j=new Array();var i=c("li",this);i.each(function(){j.push(c(this).text())});g.val(j.join(d))}});h.disableSelection()},slider:function(h,e,d){if(d.show_value){var g=e.attr("id")+"_value";var f=c(e.parents("div.fa_field")[0]);c("div.label",f).append('<label id="'+g+'">'+h.val()+"</label>");g=c("#"+g);c.extend(d,{slide:function(i,j){g.html(e.slider("value"))}})}c.extend(d,{value:parseInt(h.val()),stop:function(i,j){h.val(e.slider("value"));if(d.show_value){g.html(e.slider("value"))}}});e.slider(d)},colorpicker:function(f,e,d){c.extend(d,{click:function(g){f.val(g)},defaultColor:f.val()});e.colorPicker(d)},tabs:function(f,e,d){f.tabs(d)},accordion:function(f,e,d){f.accordion(d)},markitup:function(g,f,e){f.remove();var d=e.nameSpace;g.markItUp(c.extend(markitup_settings[d],e))},tinymce:function(f,e,d){e.remove();if(!d.width){f.css("width","100%")}if(!d.height){f.css("height","20em")}f.tinymce(d)},relation:function(g,f,d){g=g.parent("div");if(g.hasClass("ui-buttonset")){g=g.parent("div")}var e=c("button.new_relation_item",g);if(!e.length){return}e.button({icons:{primary:"ui-icon-plus"},text:false});e.click(function(){var h=c(this);var m=c('<form title="'+e.text()+'"></form>');g.append(m);var i=h.attr("alt");var l=h.attr("href");if(/\.xhr/.exec(l)){var j=l.split("/new.xhr")[0]+".xhr"}else{var j=l.split("/new")[0]}m.load(l,function(){m.dialog({modal:true,buttons:{Ok:function(){var n=m.formToArray();n=c.param(n).replace(/%5B%5D=/g,"=");c.post(j,n,function(o){if(/ui-state-error/.test(o)){m.html(o)}else{g.empty();g.load(i);m.dialog("close")}})},Cancel:function(){m.dialog("close")}}})});return false})}})})(jQuery);